---
title: "RSV Trenders"
execute:
  eval: true
  echo: false
  message: false
format: html
---



```{ojs}
data = {
  const co2data = await FileAttachment('https://raw.githubusercontent.com/wf-id/rsv-tracker/main/output/rsv_all_combined_latest.csv')
    .csv({ typed: true });
  return co2data.map(d => { 
    d["Label"] = d["state"] + ' ' + d["percent_positive"];
    return d; 
  });
}
```

Select the desired dates:


```{ojs}
states_to_select = data.map(d => d.state)
```

```{ojs}
states_to_select_use = {
    if(states_to_select === null){
        return ["NC"]
    } else {
        return states_to_select
    }
}
```


```{ojs}
//| eval: true
viewof islands = Inputs.select(["NC"].concat(states_to_select_use), {
  multiple: true, 
  label: "State", 
  initialValue: ["NC"],
  sort: true, 
  unique: true})
  
 //islands
```


```{ojs}
viewof start = Inputs.date({label: "Start date", value: "2022-01-02"})
```




```{ojs}
//#| eval: true
Plot.plot({
  y: {
    grid: true,
    label: "RSV PCR Positivity"
  },
  marks: [
    Plot.line(filtered2, {
    x: "week", 
    y: "percent_positive", 
    stroke: "state"}),
    Plot.text(filtered2, Plot.selectLast({
    x: "week",
    y: "percent_positive",
    z: "state",
    text: "state",
    textAnchor: "CasesCumulativeCNT",
    })
    ),
  ]
});
```


```{ojs}
//#| eval: true
Plot.plot({
  y: {
    grid: true,
    label: "RSV PCR Positivity Yearly Comparisons"
  },
  x: {
    label: "Week Number"
  },
  marks: [
    Plot.line(filtered, {
    x: "epi_week", 
    y: "percent_positive", 
    stroke: "epi_year"}),
    Plot.text(filtered, Plot.selectLast({
    x: "epi_week",
    y: "percent_positive",
    z: "epi_year",
    text: "epi_year",
    textAnchor: "CasesCumulativeCNT",
    })
    ),
  ]
});
```


```{ojs}
filtered = data.filter(function(data) {
  return islands.includes(data.state);
});
```

```{ojs}
filtered2 = filtered.filter(d => d.week >= start);
```


```{ojs}
Inputs.table(filtered2)
```
